[project]
name = "elevasionx-data-warehouse"

[services.backend]
root = "backend"
builder = "nixpacks"

[services.backend.deploy]
startCommand = "uvicorn app.main:app --host 0.0.0.0 --port $PORT"
preDeployCommand = ["alembic upgrade head"]
healthcheckPath = "/health/ready"
healthcheckTimeout = 30
restartPolicyType = "on-failure"
restartPolicyMaxRetries = 3

[services.frontend]
root = "frontend"
builder = "nixpacks"

[services.frontend.deploy]
startCommand = "next start --hostname :: --port ${PORT-3000}"
healthcheckPath = "/"
healthcheckTimeout = 30
